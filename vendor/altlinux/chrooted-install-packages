#!/bin/bash
set -eu

. /.host/sh-functions

[ -z "${EXCLUDE_DOCS-}" ] ||
	export RPM_EXCLUDEDOCS=1
export DURING_INSTALL=1

rpmquery -q --qf '%{NAME}-%{VERSION}-%{RELEASE}.%{ARCH}.rpm\n' -a |
while read -r n; do
	rm $verbose -f -- "/.host/rpms/$n"
done

for f in /.host/rpms/*.rpm; do
	echo "$f"
done > /.host/rpms/list

rpm -i $verbose ${EXCLUDE_DOCS:+--excludedocs} /.host/rpms/list
rm -rf -- /.host/rpms
