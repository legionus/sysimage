
# SPDX-License-Identifier: GPL-2.0-or-later
# Copyright (C) 2023  Alexey Gladkov <gladkov.alexey@gmail.com>

FROM docker.io/gentoo/stage3:latest

ARG extra=
ARG extra2=
ARG verbose=

RUN \
emerge-webrsync

RUN test -f /etc/portage/make.conf && \
sed -i -e 's/^FEATUES=/FEATUES_DISABLED=/' \
	/etc/portage/make.conf ||:

RUN mkdir -p /etc/portage && \
echo 'FEATURES="* -ipc-sandbox -network-sandbox -pid-sandbox"' >> /etc/portage/make.conf

RUN test -n "$extra" && \
emerge $verbose --ask=n $extra ||:

RUN test -d /.host/files && \
find /.host/files/ -mindepth 1 -maxdepth 1 -exec cp $verbose -arft / -- '{}' '+' ||:

RUN test -n "$extra2" && \
emerge $verbose --ask=n $extra2 ||:

# vim: ft=dockerfile
